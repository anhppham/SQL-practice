Input: 
Friendship table:
+----------+----------+
| user1_id | user2_id |
+----------+----------+
| 1        | 2        |
| 1        | 3        |
| 2        | 3        |
| 1        | 4        |
| 2        | 4        |
| 1        | 5        |
| 2        | 5        |
| 1        | 7        |
| 3        | 7        |
| 1        | 6        |
| 3        | 6        |
| 2        | 6        |
+----------+----------+
Output: 
+----------+----------+---------------+
| user1_id | user2_id | common_friend |
+----------+----------+---------------+
| 1        | 2        | 4             |
| 1        | 3        | 3             |
+----------+----------+---------------+
#window view

| user1_id | user2_id |
| -------- | -------- |
| 1        | 2        |
| 1        | 3        |
| 2        | 3        |
| 1        | 4        |
| 2        | 4        |
| 1        | 5        |
| 2        | 5        |
| 1        | 7        |
| 3        | 7        |
| 1        | 6        |
| 3        | 6        |
| 2        | 6        |
| 2        | 1        |
| 3        | 1        |
| 3        | 2        |
| 4        | 1        |
| 4        | 2        |
| 5        | 1        |
| 5        | 2        |
| 7        | 1        |
| 7        | 3        |
| 6        | 1        |
| 6        | 3        |
| 6        | 2        |

| user1_id | user2_id | user1_id | user2_id | user1_id | user2_id |
| -------- | -------- | -------- | -------- | -------- | -------- |
| 1        | 3        | 2        | 3        | 1        | 2        |
| 1        | 4        | 2        | 4        | 1        | 2        |
| 1        | 5        | 2        | 5        | 1        | 2        |
| 1        | 7        | 3        | 7        | 1        | 3        |
| 2        | 6        | 3        | 6        | 2        | 3        |
| 1        | 6        | 3        | 6        | 1        | 3        |
| 1        | 6        | 2        | 6        | 1        | 2        |
| 2        | 1        | 3        | 1        | 2        | 3        |
| 1        | 2        | 3        | 2        | 1        | 3        |
| 2        | 1        | 4        | 1        | 2        | 4        |
| 1        | 2        | 4        | 2        | 1        | 4        |
| 2        | 1        | 5        | 1        | 2        | 5        |
| 1        | 2        | 5        | 2        | 1        | 5    ...

| user1_id | user2_id | user2_id |
| -------- | -------- | -------- |
| 1        | 2        | 3        |
| 1        | 2        | 4        |
| 1        | 2        | 5        |
| 1        | 3        | 7        |
| 2        | 3        | 6        |
| 1        | 3        | 6        |
| 1        | 2        | 6        |
| 2        | 3        | 1        |
| 1        | 3        | 2        |
| 3        | 4        | 1        |
| 2        | 4        | 1        |
| 3        | 4        | 2        |
| 1        | 4        | 2        |
| 4        | 5        | 1        |
| 3        | 5        | 1        |
| 2        | 5        | 1        |
| 4        | 5        | 2        |
| 3        | 5        | 2        |
| 1        | 5        | 2        |
| 6        | 7        | 1        |
| 5        | 7        | 1        |
| 4        | 7        | 1        |
| 3        | 7        | 1        |
| 2        | 7        | 1        |
| 6        | 7        | 3        |
| 2        | 7        | 3        |
| 1        | 7        | 3        |
| 5        | 6...

#group by
| user1_id | user2_id | user1_id | user2_id | user1_id | user2_id |
| -------- | -------- | -------- | -------- | -------- | -------- |
| 1        | 3        | 2        | 3        | 1        | 2        |
| 1        | 7        | 3        | 7        | 1        | 3        |
| 2        | 6        | 3        | 6        | 2        | 3        |
| 2        | 1        | 4        | 1        | 2        | 4        |
| 1        | 2        | 4        | 2        | 1        | 4        |
| 2        | 1        | 5        | 1        | 2        | 5        |
| 1        | 2        | 5        | 2        | 1        | 5        |
| 3        | 1        | 7        | 1        | 3        | 7        |
| 1        | 3        | 7        | 3        | 1        | 7        |
| 3        | 1        | 6        | 1        | 3        | 6        |
| 2        | 1        | 6        | 1        | 2        | 6        |
| 1        | 3        | 6        | 3        | 1        | 6        |


## case 2
| user1_id | user2_id | user1_id | user2_id | user1_id | user2_id |
| -------- | -------- | -------- | -------- | -------- | -------- |
| 4        | 13       | 12       | 13       | 4        | 12       |
| 2        | 12       | 7        | 12       | 2        | 7        |
| 4        | 18       | 13       | 18       | 4        | 13       |
| 1        | 7        | 2        | 7        | 1        | 2        |
| 4        | 18       | 6        | 18       | 4        | 6        |
| 12       | 4        | 13       | 4        | 12       | 13       |
| 6        | 4        | 18       | 4        | 6        | 18       |
| 13       | 4        | 18       | 4        | 13       | 18       |
| 4        | 12       | 13       | 12       | 4        | 13       |
| 7        | 2        | 12       | 2        | 7        | 12       |
| 2        | 7        | 12       | 7        | 2        | 12       |
| 4        | 13       | 18       | 13       | 4        | 18       |
| 2        | 1        | 7        | 1        | 2        | 7    ...

| user1_id | user2_id | user1_id | user2_id |
| -------- | -------- | -------- | -------- |
| 3        | 12       | 4        | 12       |
| 2        | 12       | 4        | 12       |
| 3        | 6        | 4        | 6        |
| 4        | 13       | 12       | 13       |
| 2        | 12       | 3        | 12       |
| 3        | 12       | 7        | 12       |
| 2        | 12       | 7        | 12       |
| 4        | 12       | 7        | 12       |
| 6        | 18       | 13       | 18       |
| 4        | 18       | 13       | 18       |
| 1        | 7        | 2        | 7        |
| 4        | 18       | 6        | 18       |
| 6        | 4        | 12       | 4        |
| 1        | 4        | 12       | 4        |
| 6        | 4        | 13       | 4        |
| 12       | 4        | 13       | 4        |
| 1        | 4        | 13       | 4        |
| 2        | 1        | 4        | 1        |
| 6        | 4        | 18       | 4        |
| 13       | 4        | 18       | 4        |
| 12      ...

WITH friends AS (
    SELECT user1_id, user2_id
    FROM Friendship
    UNION ALL
    SELECT user2_id AS user1_id, user1_id AS user2_id
    FROM Friendship
)
select F1.user1_id, F2.user1_id AS user2_id, COUNT(DISTINCT F2.user2_id) AS common_friend
from friends f1 join friends f2 on f1.user1_id != f2.user1_id AND f1.user2_id = f2.user2_id and f1.user1_id < f2.user1_id
JOIN friends F3 ON F1.user1_id = F3.user1_id AND F2.user1_id = F3.user2_id
GROUP BY F1.user1_id, F2.user1_id
HAVING COUNT(DISTINCT F2.user2_id) >= 3
